# HomeLab-Renew
最新の自宅サーバー事情
* 2024年11月現在の自宅サーバー事情についてです！
![home](./home.drawio.png)

## それぞれの紹介

### 全体
自宅サーバーにはProxmoxハイパーバイザ上で仮想マシンを運用しています。（詳細は後で）
それらのサーバーに外出先からアクセスしたいが、自宅サーバーを直接公開するのは怖いのでさくらのクラウドを経由させます。

また自宅サーバーではカバーできない領域はIaaSやSaaSでカバーしています。
* 独自ドメインの運用
* CDNとWAF
* メールサーバー
* グローバルIPアドレスの使い捨て
* シングルサインオン

自宅サーバーやさくらのクラウドで運用しているものはZabbixサーバーで監視しています。

### 自宅サーバー
#### コアルーター YAMAHA RTX1200
![page2](./img/page2-001.png)
ツイッター上で投げ売りされていたのを譲っていただきました。

ルーターとしての機能はもちろん、VLANの払い出しや拠点間VPNに対応しているので重宝しています。
LANポートの点滅に憧れているわけではありません。ええ、けして

上流にはOPTAGEによるeo光ネットが繋がっています。

NTTとは異なり電力系ISPなので（動的ですが）IPv4アドレスが割り振られます。シェアードではないので、NATセッション数がRTX1200の上限である20000も有効です。神

設定すればv6アドレスも降ってくるようですが現状はしません。

またSNMPにより様々なことを監視することができます。
[SNMP MIBリファレンス - YAMAHA](https://www.rtpro.yamaha.co.jp/SW/docs/swx3200/Rev_4_00_13/other/other_snmp_mib.html?rev=4.00.13)
```config
snmp host 192.168.100.2 public
snmp trap host 192.168.100.2 public
snmp trap community GW0YahamaRTX1200
```
```bash
#LAN1のインバウンドを習得
$ snmpwalk -v 1 -c public XXXX .1.3.6.1.2.1.2.2.1.10.1
```
![sc-img1](./img/sc-image1.png)
(Zabbixで通信量を監視できる)

外部からの通信はさくらのクラウドを経由させます。
HTTPならCloudflare ZeroTrustでトンネリングすればいいですが、それ以外は対応していません。自宅サーバーのポートを開放するわけにはいかないので、外部からのリクエストはIaaS側で受けます。

![page2-002](./img/page2-002.png)
(IPsec VPNはインターネットVPNです)

さくらのクラウドは通信量に対しての課金が発生しません。好き

逆に送信元アドレスを隠蔽したいときはRTX1200で経路を設定してやればいいのです。
![page2-003](./img/page2-003.png)

このように業務用ルーターは可能性が無限大なので非常に便利で勉強への意欲もマシマシになります。
